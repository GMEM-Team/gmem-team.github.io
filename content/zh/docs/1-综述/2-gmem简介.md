---
title: GMEM简介
linktitle: GMEM简介
type: book
date: '2023-12-14T00:00:00+01:00'

# Prev/next pager order (if `docs_section_pager` enabled in `params.toml`)
weight: 2
---

GMEM革新了Linux内核中的内存管理架构，通过引入一层逻辑页表，即vm_object，将内存管理的高层逻辑与CPU硬件进一步解耦，从而抽象出能让各类加速器复用的High-Level内存管理逻辑。

加速器驱动仅需使用GMEM抽象出的High-Level API，并注册由GMEM规范好的、与加速器硬件微架构相关的MMU函数，即可将本地内存管理托管至GMEM，无需额外开发内存管理逻辑。例如，在华为自研的昇腾加速器中，使用GMEM可以免去三万行的内存管理代码。

所有通过GMEM API获取内存管理能力的加速器，均可向用户提供统一地址空间的编程框架：用户可以直接使用OS原生的mmap接口，或使用由GMEM用户态库提供的malloc函数分配统一虚拟内存；CPU和加速器均可直接使用统一虚拟内存进行编程。任意时刻，对于同一统一虚拟地址，CPU和进程中挂载的任意加速器所读写的数据均保持一致。

以上所述的一致内存视角由GMEM使能。

考虑到实际应用往往需要将领域加速器的专用计算能力，与CPU的通用计算能力相结合，GMEM允许加速器通过GMEM API将加速器挂载到用户进程中；进一步地，GMEM利用逻辑页表的信息，使用加速器注册好的MMU函数和CPU微架构的页表函数，维护了不同处理器、不同微架构间多份页表的一致性。加速器只需要注册底层函数，不再需要实现任何统一地址空间协同的高层逻辑。

除了统一地址空间编程框架之外，GMEM还提供了加速器内存的自动超售功能。在加速器内存不足时，GMEM可自动将较冷的内存换出到CPU的DRAM上。这意味着，用户无需任何适配，便可将一个内存消耗远超加速器HBM容量的应用运行在加速器上，从而在应用透明的情况下，大大拓展了应用处理问题的规模。